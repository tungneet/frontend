<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IMG Counselor</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }
        
        /* Header */
        .header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1000;
            padding: 1rem 0;
        }
        
        .nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .logo {
            font-size: 1.5rem;
            font-weight: 700;
            color: #667eea;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .nav-links {
            display: flex;
            gap: 2rem;
            list-style: none;
        }
        
        .nav-links a {
            text-decoration: none;
            color: #333;
            font-weight: 500;
            transition: color 0.3s ease;
            cursor: pointer;
        }
        
        .nav-links a:hover,
        .nav-links a.active {
            color: #667eea;
        }
        
        /* Main Content */
        .main {
            margin-top: 80px;
            min-height: calc(100vh - 80px);
            padding: 2rem 0;
        }
        
        .page {
            display: none;
            animation: fadeIn 0.5s ease;
        }
        
        .page.active {
            display: block;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* Hero Section */
        .hero {
            text-align: center;
            padding: 4rem 0;
            color: white;
        }
        
        .hero h1 {
            font-size: 3.5rem;
            font-weight: 700;
            margin-bottom: 1rem;
            background: linear-gradient(45deg, #fff, #f0f0f0);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .hero p {
            font-size: 1.2rem;
            margin-bottom: 2rem;
            opacity: 0.9;
        }
        
        /* Chat Interface */
        .chat-container {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            margin: 2rem auto;
            max-width: 800px;
            overflow: hidden;
        }
        
        .chat-header {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 1.5rem;
            text-align: center;
        }
        
        .chat-body {
            padding: 2rem;
        }
        
        .user-info {
            background: #f8f9fa;
            padding: 1rem;
            border-radius: 10px;
            margin-bottom: 1.5rem;
            font-size: 0.9rem;
            color: #666;
        }
        
        .input-group {
            margin-bottom: 1.5rem;
        }
        
        .input-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: #333;
        }
        
        textarea, input[type="text"], input[type="email"] {
            width: 100%;
            padding: 1rem;
            border: 2px solid #e9ecef;
            border-radius: 12px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
            font-family: inherit;
        }
        
        textarea:focus, input[type="text"]:focus, input[type="email"]:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .btn {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 1rem 2rem;
            border-radius: 25px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            margin: 0.5rem 0.5rem 0.5rem 0;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }
        
        .btn-secondary {
            background: linear-gradient(135deg, #6c757d, #5a6268);
        }
        
        .btn-secondary:hover {
            box-shadow: 0 10px 20px rgba(108, 117, 125, 0.3);
        }
        
        /* Response Area */
        .response-area {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 1.5rem;
            margin: 1.5rem 0;
            border-left: 4px solid #667eea;
        }
        
        .response-area h3 {
            color: #667eea;
            margin-bottom: 1rem;
        }
        
        /* FAQ Section */
        .faq-item {
            background: white;
            border-radius: 12px;
            margin: 1rem 0;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            overflow: hidden;
        }
        
        .faq-question {
            padding: 1rem 1.5rem;
            cursor: pointer;
            font-weight: 600;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: background-color 0.3s ease;
        }
        
        .faq-question:hover {
            background-color: #f8f9fa;
        }
        
        .faq-answer {
            padding: 0 1.5rem 1.5rem;
            display: none;
            color: #666;
            line-height: 1.6;
        }
        
        .faq-answer.active {
            display: block;
        }
        
        .faq-question .arrow.rotated {
            transform: rotate(180deg);
        }
        
        /* Rating */
        .rating-container {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            margin: 1.5rem 0;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        }
        
        .stars {
            display: flex;
            gap: 0.5rem;
            margin: 1rem 0;
        }
        
        .star {
            font-size: 1.5rem;
            cursor: pointer;
            color: #ddd;
            transition: color 0.2s ease;
        }
        
        .star.active {
            color: #ffc107;
        }
        
        /* Content Pages */
        .content-page {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            margin: 2rem auto;
            max-width: 800px;
            padding: 3rem;
        }
        
        .content-page h1 {
            color: #667eea;
            margin-bottom: 2rem;
            font-size: 2.5rem;
        }
        
        .content-page h2 {
            color: #333;
            margin: 2rem 0 1rem 0;
            font-size: 1.5rem;
        }
        
        .content-page p {
            line-height: 1.6;
            margin-bottom: 1rem;
            color: #555;
        }
        
        /* History */
        .history-item {
            background: white;
            border-radius: 12px;
            margin: 1rem 0;
            padding: 1.5rem;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        }
        
        .history-item h4 {
            color: #667eea;
            margin-bottom: 0.5rem;
        }
        
        .history-item p {
            color: #666;
            margin-bottom: 1rem;
        }
        
        /* User Management */
        .user-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
            margin-top: 2rem;
        }
        
        .user-card {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        }
        
        /* Loading Spinner */
        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 2rem auto;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Status Messages */
        .status {
            padding: 1rem;
            border-radius: 12px;
            margin: 1rem 0;
        }
        
        .status.success {
            background: #d4edda;
            color: #155724;
            border-left: 4px solid #28a745;
        }
        
        .status.error {
            background: #f8d7da;
            color: #721c24;
            border-left: 4px solid #dc3545;
        }
        
        .status.warning {
            background: #fff3cd;
            color: #856404;
            border-left: 4px solid #ffc107;
        }
        
        /* Mobile Responsive */
        @media (max-width: 768px) {
            .nav-links {
                display: none;
            }
            
            .hero h1 {
                font-size: 2.5rem;
            }
            
            .user-grid {
                grid-template-columns: 1fr;
            }
            
            .chat-body {
                padding: 1rem;
            }
            
            .content-page {
                padding: 2rem;
                margin: 1rem;
            }
        }
    </style>
</head>
<body>
    <header class="header">
        <div class="container">
            <nav class="nav">
                <div class="logo">
                    ‚öïÔ∏è IMG Counselor
                </div>
                <ul class="nav-links">
                    <li><a href="#" onclick="showPage('search')" class="active">Search</a></li>
                    <li><a href="#" onclick="showPage('about')">About Us</a></li>
                    <li><a href="#" onclick="showPage('faqs')">FAQs</a></li>
                    <li><a href="#" onclick="showPage('contact')">Contact</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <main class="main">
        <div class="container">
            <!-- Search Page (Main Chat Interface) -->
            <div id="search" class="page active">
                <div class="hero">
                    <h1>IMG Counselor</h1>
                    <p>Your AI-powered guide for International Medical Graduate applications</p>
                </div>

                <div class="chat-container">
                    <div class="chat-header">
                        <h2>Search for IMG Related Information</h2>
                    </div>
                    <div class="chat-body">
                        <div class="user-info">
                            <strong>Current User:</strong> <span id="currentUser">user_1234</span>
                            <button class="btn btn-secondary" onclick="showUserManagement()" style="float: right; padding: 0.5rem 1rem; font-size: 0.8rem;">Manage Users</button>
                        </div>

                        <div class="input-group">
                            <label for="question">Ask your question:</label>
                            <textarea id="question" rows="4" placeholder="Enter your IMG-related question here..."></textarea>
                        </div>

                        <button class="btn" onclick="sendMessage()">Send Question</button>
                        <button class="btn btn-secondary" onclick="loadHistory()">View History</button>
                        <button class="btn btn-secondary" onclick="testConnection()">Test Connection</button>

                        <div id="loading" style="display: none;">
                            <div class="spinner"></div>
                            <p style="text-align: center;">Thinking...</p>
                        </div>

                        <div id="response" class="response-area" style="display: none;">
                            <h3>Here's the information:</h3>
                            <div id="responseContent"></div>
                        </div>

                        <div id="chatFaqs" style="display: none;">
                            <h3>Related FAQs:</h3>
                            <div id="faqContent"></div>
                        </div>

                        <div id="rating" class="rating-container" style="display: none;">
                            <h4>Rate this response:</h4>
                            <div class="stars" id="starRating">
                                <span class="star" onclick="setRating(1)">‚òÖ</span>
                                <span class="star" onclick="setRating(2)">‚òÖ</span>
                                <span class="star" onclick="setRating(3)">‚òÖ</span>
                                <span class="star" onclick="setRating(4)">‚òÖ</span>
                                <span class="star" onclick="setRating(5)">‚òÖ</span>
                            </div>
                            <div class="input-group">
                                <label for="suggestion">Suggestions for improvement (optional):</label>
                                <textarea id="suggestion" rows="3" placeholder="How can we improve this response?"></textarea>
                            </div>
                            <button class="btn" onclick="submitRating()">Submit Feedback</button>
                        </div>

                        <!-- User Management Modal -->
                        <div id="userManagement" style="display: none;">
                            <div class="user-grid">
                                <div class="user-card">
                                    <h3>Switch User</h3>
                                    <div class="input-group">
                                        <label for="newUserId">New User ID:</label>
                                        <input type="text" id="newUserId" value="user_5678">
                                    </div>
                                    <button class="btn" onclick="changeUser()">Change User</button>
                                </div>
                                <div class="user-card">
                                    <h3>Active Users</h3>
                                    <button class="btn btn-secondary" onclick="loadActiveUsers()">Refresh User List</button>
                                    <div id="activeUsers"></div>
                                </div>
                            </div>
                        </div>

                        <!-- History Section -->
                        <div id="historySection" style="display: none;">
                            <h3>Chat History</h3>
                            <div id="historyContent"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- About Us Page -->
            <div id="about" class="page">
                <div class="content-page">
                    <h1>About IMG Counselor</h1>
                    <p>Welcome to IMG Counselor, your trusted companion in navigating the complex journey of International Medical Graduate (IMG) applications.</p>
                    
                    <h2>Our Mission</h2>
                    <p>We intend to help IMGs get their desired medical residency positions while spending less on application fees. Our AI-powered platform provides personalized guidance, helping you make informed decisions about where to apply and how to maximize your chances of success.</p>
                    
                    <h2>What We Offer</h2>
                    <p>‚Ä¢ <strong>Smart Application Strategy:</strong> Get personalized recommendations on which programs to apply to based on your profile</p>
                    <p>‚Ä¢ <strong>Cost Optimization:</strong> Reduce unnecessary application fees by targeting the right programs</p>
                    <p>‚Ä¢ <strong>Real-time Guidance:</strong> 24/7 AI assistant to answer your IMG-related questions</p>
                    <p>‚Ä¢ <strong>Success Analytics:</strong> Data-driven insights to improve your application strategy</p>
                    
                    <h2>Why Choose Us?</h2>
                    <p>Traditional application processes can be overwhelming and expensive. Our platform leverages artificial intelligence and comprehensive data analysis to provide you with targeted advice, potentially saving you thousands of dollars in application fees while increasing your chances of matching into your preferred residency program.</p>
                    
                    <p>Join thousands of IMGs who have successfully navigated their residency applications with our guidance.</p>
                </div>
            </div>

            <!-- FAQs Page -->
            <div id="faqs" class="page">
                <div class="content-page">
                    <h1>IMG Counselor FAQ</h1>
                    <p>Comprehensive guide for International Medical Graduates</p>

                    <div class="faq-section">
                        <h2>ECFMG Certification & Basic Eligibility</h2>
                        <div class="faq-item">
                            <div class="faq-question" onsiteclick="toggleFAQ(this)">
                                What is ECFMG Certification and why is it essential for IMGs?
                                <span class="arrow">‚ñº</span>
                            </div>
                            <div class="faq-answer">
                                ECFMG (Educational Commission for Foreign Medical Graduates) Certification is mandatory for all International Medical Graduates to be eligible for US residency programs. It verifies your medical education credentials, ensures you meet US standards, and serves as a prerequisite for the NRMP Match. Without ECFMG certification, you cannot participate in the residency match process.
                            </div>
                        </div>
                        <div class="faq-item">
                            <div class="faq-question" onclick="toggleFAQ(this)">
                                What are the USMLE exams I need to pass for ECFMG Certification?
                                <span class="arrow">‚ñº</span>
                            </div>
                            <div class="faq-answer">
                                You must pass USMLE Step 1 and Step 2 CK (Clinical Knowledge) for ECFMG certification. Step 1 tests basic medical sciences, while Step 2 CK evaluates clinical knowledge and patient care skills. Step 3 is not required for certification but may be needed for certain visa types or programs.
                            </div>
                        </div>
                        <div class="faq-item">
                            <div class="faq-question" onclick="toggleFAQ(this)">
                                How long does the ECFMG certification process typically take?
                                <span class="arrow">‚ñº</span>
                            </div>
                            <div class="faq-answer">
                                The ECFMG certification process typically takes 4-8 weeks after all requirements are met. This includes credential verification, exam score reporting, and final certificate issuance. However, delays can occur due to document verification issues or high application volumes.
                            </div>
                        </div>
                    </div>

                    <div class="faq-section">
                        <h2>USMLE Exams</h2>
                        <div class="faq-item">
                            <div class="faq-question" onclick="toggleFAQ(this)">
                                What is a competitive USMLE score for IMGs?
                                <span class="arrow">‚ñº</span>
                            </div>
                            <div class="faq-answer">
                                For IMGs, competitive scores vary by specialty: Step 1: 240+ (highly competitive), 220-240 (competitive), 200-220 (acceptable for some programs). Step 2 CK: 250+ (excellent), 240-250 (very good), 230-240 (good). Remember, Step 1 is now Pass/Fail, making Step 2 CK scores more critical.
                            </div>
                        </div>
                        <div class="faq-item">
                            <div class="faq-question" onclick="toggleFAQ(this)">
                                How many attempts do I have for each USMLE Step?
                                <span class="arrow">‚ñº</span>
                            </div>
                            <div class="faq-answer">
                                You have 6 attempts for each USMLE Step within a 7-year period. Multiple attempts can impact your application negatively, so thorough preparation is crucial. Programs often view first-attempt passes more favorably than multiple attempts.
                            </div>
                        </div>
                    </div>

                    <div class="faq-section">
                        <h2>US Clinical Experience (USCE)</h2>
                        <div class="faq-item">
                            <div class="faq-question" onclick="toggleFAQ(this)">
                                What is US Clinical Experience and why is it important?
                                <span class="arrow">‚ñº</span>
                            </div>
                            <div class="faq-answer">
                                USCE refers to clinical rotations, observerships, or research experiences in US healthcare settings. It's crucial for IMGs as it demonstrates familiarity with the US healthcare system, provides networking opportunities, and helps secure strong letters of recommendation from US physicians.
                            </div>
                        </div>
                        <div class="faq-item">
                            <div class="faq-question" onclick="toggleFAQ(this)">
                                Which types of USCE are most valued?
                                <span class="arrow">‚ñº</span>
                            </div>
                            <div class="faq-answer">
                                Hands-on clinical rotations (externships/sub-internships) are most valued, followed by observerships with meaningful patient interaction. Research experiences in US institutions are also valuable, especially if they lead to publications. Avoid purely observational experiences with minimal interaction.
                            </div>
                        </div>
                    </div>

                    <div class="faq-section">
                        <h2>Application Process (ERAS)</h2>
                        <div class="faq-item">
                            <div class="faq-question" onclick="toggleFAQ(this)">
                                What documents are required for ERAS application?
                                <span class="arrow">‚ñº</span>
                            </div>
                            <div class="faq-answer">
                                Required documents include: Common Application Form, Personal Statement, Letters of Recommendation (3-4), MSPE/Dean's Letter, Medical School Transcript, USMLE Transcript, ECFMG Status Report, Professional Photo, and CV. Some programs may require additional specialty-specific documents.
                            </div>
                        </div>
                        <div class="faq-item">
                            <div class="faq-question" onclick="toggleFAQ(this)">
                                How many programs should an IMG typically apply to?
                                <span class="arrow">‚ñº</span>
                            </div>
                            <div class="faq-answer">
                                IMGs typically apply to 80-150 programs depending on their competitiveness and specialty choice. Highly competitive specialties may require 150+ applications, while primary care specialties might need 80-120. Quality over quantity is important - research programs thoroughly.
                            </div>
                        </div>
                    </div>

                    <div class="faq-section">
                        <h2>Interview Process & Match</h2>
                        <div class="faq-item">
                            <div class="faq-question" onclick="toggleFAQ(this)">
                                How should I prepare for residency interviews as an IMG?
                                <span class="arrow">‚ñº</span>
                            </div>
                            <div class="faq-answer">
                                Prepare by researching each program thoroughly, practicing common questions (Why this specialty? Why our program? Tell me about yourself), preparing stories that highlight your strengths, understanding current healthcare issues, and being ready to address any gaps or weaknesses in your application professionally.
                            </div>
                        </div>
                        <div class="faq-item">
                            <div class="faq-question" onclick="toggleFAQ(this)">
                                What happens if I don't match in the main match?
                                <span class="arrow">‚ñº</span>
                            </div>
                            <div class="faq-answer">
                                If you don't match, you can participate in SOAP (Supplemental Offer and Acceptance Program) immediately after Match Day. If unsuccessful in SOAP, options include taking a research year, gaining more USCE, improving USMLE scores, considering preliminary/transitional year programs, or applying again next cycle.
                            </div>
                        </div>
                    </div>

                    <div class="faq-section">
                        <h2>Visas for Residency</h2>
                        <div class="faq-item">
                            <div class="faq-question" onclick="toggleFAQ(this)">
                                What are the common visa types for IMG residency?
                                <span class="arrow">‚ñº</span>
                            </div>
                            <div class="faq-answer">
                                The two main visa types are J-1 and H-1B. J-1 is more common, easier to obtain, but requires returning to home country for 2 years after training (unless waived). H-1B allows dual intent (path to green card) but is harder to obtain and requires Step 3 passage before residency.
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Contact Page -->
            <div id="contact" class="page">
                <div class="content-page">
                    <h1>Contact Us</h1>
                    <p>Have questions, suggestions, or need support? We'd love to hear from you!</p>
                    
                    <div class="input-group">
                        <label for="contactName">Your Name:</label>
                        <input type="text" id="contactName" placeholder="Enter your full name">
                    </div>
                    
                    <div class="input-group">
                        <label for="contactEmail">Your Email:</label>
                        <input type="email" id="contactEmail" placeholder="Enter your email address">
                    </div>
                    
                    <div class="input-group">
                        <label for="contactMessage">Your Message:</label>
                        <textarea id="contactMessage" rows="6" placeholder="Describe your issue, suggestion, or inquiry..."></textarea>
                    </div>
                    
                    <button class="btn" onclick="submitContact()">Send Message</button>
                    
                    <div style="margin-top: 3rem; padding-top: 2rem; border-top: 1px solid #eee;">
                        <h2>Other Ways to Reach Us</h2>
                        <p><strong>Email:</strong> support@imgcounselor.com</p>
                        <p><strong>Response Time:</strong> We typically respond within 24 hours</p>
                        <p><strong>Business Hours:</strong> Monday - Friday, 9 AM - 6 PM EST</p>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <script>
        // API Configuration
        const API_BASE_URL = "https://xzi0jposzj.execute-api.ap-south-1.amazonaws.com/development";

        // State Management
        let currentUser = "user_1234";
        let apiConnected = false;
        let lastQuestion = "";
        let lastResponse = "";
        let currentRating = 0;

        // Page Navigation
        function showPage(pageId) {
            // Hide all pages
            document.querySelectorAll('.page').forEach(page => {
                page.classList.remove('active');
            });
            
            // Show selected page
            document.getElementById(pageId).classList.add('active');
            
            // Update navigation
            document.querySelectorAll('.nav-links a').forEach(link => {
                link.classList.remove('active');
            });
            document.querySelector(`.nav-links a[onclick="showPage('${pageId}')"]`).classList.add('active');
        }

        // API Functions
        async function testConnection() {
            showStatus("Testing connection...", "info");
            try {
                const response = await fetch(`${API_BASE_URL}/get-active-users`, { timeout: 5000 });
                if (response.ok) {
                    apiConnected = true;
                    showStatus("‚úÖ Successfully connected to API", "success");
                } else {
                    throw new Error("Connection failed");
                }
            } catch (error) {
                apiConnected = false;
                showStatus("‚ùå Connection failed. Please check API status.", "error");
            }
        }

        async function sendMessage() {
            const question = document.getElementById('question').value.trim();
            if (!question) {
                showStatus("Please enter a question.", "warning");
                return;
            }

            if (!apiConnected) {
                showStatus("Please test API connection first.", "warning");
                return;
            }

            // Show loading
            document.getElementById('loading').style.display = 'block';
            document.getElementById('response').style.display = 'none';
            document.getElementById('chatFaqs').style.display = 'none';
            document.getElementById('rating').style.display = 'none';

            try {
                const response = await fetch(`${API_BASE_URL}/chat`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ user_id: currentUser, question: question })
                });

                const result = await response.json();
                document.getElementById('loading').style.display = 'none';

                if (result.answer) {
                    // Clean and display answer
                    const uniqueLines = [...new Set(result.answer.split('\n'))];
                    const cleanedAnswer = uniqueLines.join('\n');
                    
                    document.getElementById('responseContent').innerHTML = cleanedAnswer.replace(/\n/g, '<br>');
                    document.getElementById('response').style.display = 'block';

                    // Display FAQs if available
                    if (result.faqs && result.faqs.length > 0) {
                        displayFaqs(result.faqs, result.faq_intro);
                    }

                    // Store for rating
                    lastQuestion = question;
                    lastResponse = cleanedAnswer;
                    document.getElementById('rating').style.display = 'block';
                    
                    // Clear question
                    document.getElementById('question').value = '';
                } else if (result.error) {
                    showStatus(`Error: ${result.error}`, "error");
                }
            } catch (error) {
                document.getElementById('loading').style.display = 'none';
                showStatus(`API Error: ${error.message}`, "error");
            }
        }

        function displayFaqs(faqs, intro) {
            const faqContent = document.getElementById('faqContent');
            let html = '';
            
            if (intro) {
                html += `<h4>${intro}</h4>`;
            }
            
            faqs.forEach((faq, index) => {
                html += `
                    <div class="faq-item">
                        <div class="faq-question" onclick="toggleChatFaq(${index})">
                            ${faq.question}
                            <span>+</span>
                        </div>
                        <div class="faq-answer" id="chatFaq${index}">
                            <strong>Q:</strong> ${faq.question}<br>
                            <strong>A:</strong> ${faq.answer}
                        </div>
                    </div>
                `;
            });
            
            faqContent.innerHTML = html;
            document.getElementById('chatFaqs').style.display = 'block';
        }

        function toggleChatFaq(index) {
            const answer = document.getElementById(`chatFaq${index}`);
            const question = answer.previousElementSibling;
            const icon = question.querySelector('span');
            
            if (answer.classList.contains('active')) {
                answer.classList.remove('active');
                icon.classList.remove('rotated');
            } else {
                // Close all other open FAQs
                document.querySelectorAll('#chatFaqs .faq-answer.active').forEach(item => {
                    item.classList.remove('active');
                });
                document.querySelectorAll('#chatFaqs .faq-question span.rotated').forEach(arrow => {
                    arrow.classList.remove('rotated');
                });
                
                // Open clicked FAQ
                answer.classList.add('active');
                icon.classList.add('rotated');
            }
        }

        // FAQ Toggle for Static FAQs Page
        function toggleFAQ(element) {
            const answer = element.nextElementSibling;
            const arrow = element.querySelector('.arrow');
            
            if (answer.classList.contains('active')) {
                answer.classList.remove('active');
                arrow.classList.remove('rotated');
            } else {
                // Close all other open FAQs
                document.querySelectorAll('.faq-answer.active').forEach(item => {
                    item.classList.remove('active');
                });
                document.querySelectorAll('.arrow.rotated').forEach(arrow => {
                    arrow.classList.remove('rotated');
                });
                
                // Open clicked FAQ
                answer.classList.add('active');
                arrow.classList.add('rotated');
            }
        }

        // Rating System
        function setRating(rating) {
            currentRating = rating;
            const stars = document.querySelectorAll('.star');
            stars.forEach((star, index) => {
                if (index < rating) {
                    star.classList.add('active');
                } else {
                    star.classList.remove('active');
                }
            });
        }

        async function submitRating() {
            if (currentRating === 0) {
                showStatus("Please select a rating before submitting.", "warning");
                return;
            }

            const suggestion = document.getElementById('suggestion').value.trim();
            
            try {
                const payload = {
                    user_id: currentUser,
                    question: lastQuestion,
                    rating: currentRating
                };
                
                if (suggestion) {
                    payload.suggestion = suggestion;
                }

                const response = await fetch(`${API_BASE_URL}/rate-answer`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                const result = await response.json();
                
                if (result.message) {
                    showStatus("Rating and suggestion submitted. We appreciate your feedback! üôÇ", "success");
                    document.getElementById('rating').style.display = 'none';
                } else if (result.error) {
                    showStatus(`Error: ${result.error}`, "error");
                }
            } catch (error) {
                showStatus(`API Error: ${error.message}`, "error");
            }
        }

        // User Management
        function showUserManagement() {
            const userMgmt = document.getElementById('userManagement');
            userMgmt.style.display = userMgmt.style.display === 'none' ? 'block' : 'none';
        }

        async function changeUser() {
            const newUserId = document.getElementById('newUserId').value.trim();
            if (!newUserId) {
                showStatus("Please enter a new user ID.", "warning");
                return;
            }

            try {
                const response = await fetch(`${API_BASE_URL}/change-user`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ current_user_id: currentUser, new_user_id: newUserId })
                });

                const result = await response.json();
                
                if (result.message) {
                    currentUser = newUserId;
                    document.getElementById('currentUser').textContent = newUserId;
                    showStatus(`Successfully switched to: ${newUserId}`, "success");
                    document.getElementById('userManagement').style.display = 'none';
                } else if (result.error) {
                    showStatus(`Error: ${result.error}`, "error");
                }
            } catch (error) {
                showStatus(`API Error: ${error.message}`, "error");
            }
        }

        async function loadActiveUsers() {
            try {
                const response = await fetch(`${API_BASE_URL}/get-active-users`);
                const result = await response.json();
                
                if (result.active_users) {
                    const usersDiv = document.getElementById('activeUsers');
                    if (result.active_users.length > 0) {
                        let html = '<h4>Currently Active Users:</h4><ul>';
                        result.active_users.forEach(user => {
                            html += `<li style="margin: 0.5rem 0; color: #667eea;">${user}</li>`;
                        });
                        html += '</ul>';
                        usersDiv.innerHTML = html;
                    } else {
                        usersDiv.innerHTML = '<p style="color: #666;">No active users found</p>';
                    }
                } else if (result.error) {
                    showStatus(`Error: ${result.error}`, "error");
                }
            } catch (error) {
                showStatus(`API Error: ${error.message}`, "error");
            }
        }

        // History Management
        async function loadHistory() {
            const historySection = document.getElementById('historySection');
            historySection.style.display = historySection.style.display === 'none' ? 'block' : 'none';
            
            if (historySection.style.display === 'block') {
                try {
                    const response = await fetch(`${API_BASE_URL}/get-history/${currentUser}`);
                    const result = await response.json();
                    
                    if (result.chats) {
                        const historyContent = document.getElementById('historyContent');
                        if (Object.keys(result.chats).length > 0) {
                            let html = '';
                            Object.entries(result.chats).forEach(([title, chat]) => {
                                html += `
                                    <div class="history-item">
                                        <h4>üí¨ ${title}</h4>
                                        <p><strong>Question:</strong><br>${chat.question}</p>
                                        <p><strong>Answer:</strong><br>${chat.answer}</p>
                                    </div>
                                `;
                            });
                            historyContent.innerHTML = html;
                        } else {
                            historyContent.innerHTML = '<p style="color: #666; text-align: center; padding: 2rem;">No chat history found for this user</p>';
                        }
                    } else if (result.error) {
                        showStatus(`Error: ${result.error}`, "error");
                    }
                } catch (error) {
                    showStatus(`API Error: ${error.message}`, "error");
                }
            }
        }

        // Contact Form
        async function submitContact() {
            const name = document.getElementById('contactName').value.trim();
            const email = document.getElementById('contactEmail').value.trim();
            const message = document.getElementById('contactMessage').value.trim();

            if (!name || !email || !message) {
                showStatus("Please fill out all fields before submitting.", "warning");
                return;
            }

            try {
                const response = await fetch(`${API_BASE_URL}/contact-us`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ name, email, message })
                });

                const result = await response.json();
                
                if (result.message) {
                    showStatus("Your message was submitted successfully. We'll get back to you soon.", "success");
                    // Clear form
                    document.getElementById('contactName').value = '';
                    document.getElementById('contactEmail').value = '';
                    document.getElementById('contactMessage').value = '';
                } else if (result.error) {
                    showStatus(`Error: ${result.error}`, "error");
                }
            } catch (error) {
                showStatus(`API Error: ${error.message}`, "error");
            }
        }

        // Status Message Display
        function showStatus(message, type) {
            // Remove existing status messages
            const existingStatus = document.querySelector('.status');
            if (existingStatus) {
                existingStatus.remove();
            }

            // Create new status message
            const statusDiv = document.createElement('div');
            statusDiv.className = `status ${type}`;
            statusDiv.innerHTML = message;

            // Insert after the chat body or main content area
            const targetElement = document.querySelector('.chat-body') || document.querySelector('.content-page') || document.body;
            targetElement.appendChild(statusDiv);

            // Auto-remove after 5 seconds
            setTimeout(() => {
                if (statusDiv.parentNode) {
                    statusDiv.remove();
                }
            }, 5000);
        }

        // Initialize app
        document.addEventListener('DOMContentLoaded', function() {
            // Test connection on load
            testConnection();
            
            // Set initial user
            const currentUserElement = document.getElementById('currentUser');
            if (currentUserElement) {
                currentUserElement.textContent = currentUser;
            }
        });

        // Mobile menu toggle
        function toggleMobileMenu() {
            const navLinks = document.querySelector('.nav-links');
            if (navLinks) {
                navLinks.style.display = navLinks.style.display === 'none' ? 'flex' : 'none';
            }
        }

        // Add mobile menu button functionality
        window.addEventListener('resize', function() {
            if (window.innerWidth <= 768) {
                const nav = document.querySelector('.nav');
                if (nav && !nav.querySelector('.mobile-menu-btn')) {
                    const mobileMenuBtn = document.createElement('button');
                    mobileMenuBtn.className = 'mobile-menu-btn';
                    mobileMenuBtn.innerHTML = '‚ò∞';
                    mobileMenuBtn.style.cssText = `
                        background: none;
                        border: none;
                        font-size: 1.5rem;
                        cursor: pointer;
                        color: #667eea;
                        display: block;
                    `;
                    mobileMenuBtn.onclick = toggleMobileMenu;
                    nav.appendChild(mobileMenuBtn);
                }
            } else {
                const mobileBtn = document.querySelector('.mobile-menu-btn');
                if (mobileBtn) {
                    mobileBtn.remove();
                }
                const navLinks = document.querySelector('.nav-links');
                if (navLinks) {
                    navLinks.style.display = 'flex';
                }
            }
        });
    </script>
</body>
</html>